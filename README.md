# CaduceusTour

**«CaduseusTour»** — это чат-бот для мессенджера Telegram. В первую очередь, чат-бот отображает информацию о заказах государственных органов Российской Федерации (далее "госзаказ") от имени публично-правовых образований (федеральных и муниципальных учреждений) по 44-ФЗ . Для получения данных есть две опции запроса:
1. реквизиты (на выбор — наименование и юридический адрес);

Список госзаказов отсортирован по дате размещения заявки (последний элемент — это госзаказ, который имеет самую раннюю дату размещения).

2. код субъекта Российской Федерации ("РФ");

Список госзаказов отсортирован в порядке убывания максимальной цены. Также тут доступен вариант получить сведения о размещенных госзаказах от имени всех публично-правовых образований РФ.

После успешной обработки запроса будет доступно следующее: 
1. *получение списка госзаказов*;

С техническорой стороны, результат оформляется как "очередь", размер которого задан в 20 элементов и где каждый элемент — это отдельный госзаказ и включает в себя такие сведения, как стоимость заказа, описание услуги, дата размещения, выбранная площадка для аукциона/конкурса и так далее. В окне чата это выглядит следующим образом: нажимая кнопку "дальше", пользователь получает от бота сообщение со следующим элементом очереди, в котором приведено описание госзаказа с названными данными. Когда пользователь доходит до конца очереди или проматывает её (одна из опций бота при просмотре списка), то она автоматически обновляется (пока есть госзаказы, у которых есть более ранняя дата размещения заявки). Кроме того, все элементы текущей очереди можно загрузить в текстовом документе. 
Просматривая элемент, можно запросить сводку организации — в случае с просмотром по коду субъекта РФ, сводка будет сделана для той организации, информация о которой была отправлена последним сообщением ботом.  

 2. *получение сводки организации*;
 
Ещё одной функцией чат-бота является составление сводки, где исходя из данных об успешно завершенных госзаказов публично-правового образования рассчитываются показатели средних значений расходов, а также приводится сумма максимальной и минимальной стоимости с описанием услуг. Затем можно сопоставить показатели двух организаций — за это отвечает другая функция чат-бота, которая рассчитывает разницу всех значений за конкретный период (определяется автоматически) и отправляет результат в виде двух списков одним сообщением. Каждый список представляет собой перечень, где указывается наименование показателя и соотвественная величина, описывающая положительную разницу — но в первом списке перечисляется то, в чём у первой организации преимущество, а во втором, в чём она уступает. После чего можно запросить список госзаказов организации, с которой проводилось сравнение. 
____
### ПРИМЕРЫ

#### 1. Получение информации о госзаказах ФГБУК «Государственный Эрмитаж». 

+ 1.1. После запуска бота в чате будет открыто меню с двумя кнопками: "организация" и "регион" — тут необходимо выбрать первое.
+ 1.2. Затем откроется меню с такими кнопками: "наименование" и "юр.адрес" - это варианты поиска по реквизитам, нажимаем на первое, в окне с ботом набираем сообщение "Эрмитаж" и отправляем его боту.
+ 1.3. Когда запрос успешно обработается, выйдет такое меню: "характеристика", "список закупок", "назад" — из этого всего нужен "список закупок". Следующим же сообщением бот отправит сообщение с информацией о госзаказе и откроется меню просмотра ("характеристика", "дальше", "документ", "меню"). 
+ 1.4. Чтобы просмотреть другие госзаказы, для этого достаточно нажать "дальше" в меню просмотра. Или "документ" - тогда бот предложит загрузить текстовой документ, в котором приведены сведения о 20 госзаказах, после чего можно нажать "промотать ряд" и когда появится сообщение с госзаказом, который пронумерован как "1 из 20", то загружаем следующий документ для следующей очереди.
+ 1.5. Для получения сводки в меню просмотра есть кнопка "характеристика" — просто нажимаем на неё и бот отправит готовую сводку, при этом откроется меню просмотра характеристики ("сравнить","список закупок","меню")
+ 1.6. Чтобы сопоставить показатели сводки с другой организацией есть кнопка "сравнить" — нажимаем на неё и потом будет предложены варианты поиска по реквизитам: "наименование" и "юр.адрес". На этот раз выберем "юр.адрес" и введем "191011, Петербург, площадь островского, 6" (адрес Александринского Театра). 
+ 1.7. Затем от бота придёт два сообщения: одно из них сводка Александринского Театра, а второе это само сопоставление.
+ 1.8. Далее можно посмотреть список госзакупок Александринского Театра, нажав в меню кнопку "список госзакупок"
+ 1.9. Или можно перейти в главное меню ("организация","регион"), нажав на кнопку "меню". 

#### 2. Получение информации о госзаказах со всей территории РФ. 

+ 2.1. Нажимаем кнопку "регион" в главном меню
+ 2.2. Откроется новое меню с кнопками: "РФ", "код региона", "назад". Нажимаем на "РФ"
+ 2.3. После обработки бот отправит сообщение о госзаказе, у которого указана самая высокая цена за услугу и будет открыто меню просмотра("характеристика", "дальше", "документ", "меню"). Следующие госзаказы идут по убыванию стоимости — для просмотра есть кнопки "дальше" и "документ", нажав на вторую бот предложит загрузить текстовой документ с 20 госзаказами. Кнопка "характеристика" показывает сводку организации, информация о которой была отправлена последним сообщением ботом.  
____
### КОНСТРУКЦИЯ

Подключение к API мессенджера Telegram сделано по методу Webhook. 

Для доступа и получения данных используется сервис ГосПланAPI. В том числе реализован механизм автоматического обновления ключа доступа по истечению его срока валидности. 

Репозиторий: NoSQL СУБД MongoDB.

Среди задействованных библиотек имеется: 

- goquery (парсинг сайтов (необходимо для идентифицирования публично-правового образования по юридическому адресу));
- logrus (логирование);
- goConvey (тестирование);

и так далее. С полным перечнем можно ознакомиться в самом коде. 

#### TODO:
1. сохранение сводок в базе данных 
2. переработать поиск по юридическому адресу
